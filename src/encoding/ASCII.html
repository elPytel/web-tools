<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>Text ⇄ ASCII / UTF-8 převodník</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link rel="stylesheet" href="../css/style.css">
  <style>
    textarea { min-height: 140px; }
    .controls > * { margin: 4px 0; }
    .controls.equal {
      display: grid;
      grid-template-columns: repeat(5, minmax(120px, 1fr));
      gap: 8px;
      align-items: center;
    }
    @media (max-width: 900px) { .controls.equal { display: flex; flex-wrap: wrap; } }
    
    button:hover { background: #f1f1f1; }
    .small { font-size: 12px; color: #555; }
    th, td { padding: 6px 8px; border-bottom: 1px solid #eee; text-align: left; }
    @media (max-width: 900px) { .row { grid-template-columns: 1fr; } }
    code { background: #f3f3f3; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <script type="module" src="../js/site-header.js"></script>
      <site-header title="Text ⇄ ASCII / UTF-8"></site-header>
    </div>
    <div class="card">
      <div class="small">
        <b>Režim:</b> <code>ASCII</code> nahrazuje znaky &gt;127 za <code>?</code>. <code>UTF-8</code> převádí text na sekvenci bajtů (funguje pro češtinu i emoji).
      </div>
      <br>
  <div class="controls equal">
        <label><b>Režim:</b>
          <select id="mode">
            <option value="ascii">ASCII (0–127)</option>
            <option value="utf8">UTF-8 (bajty)</option>
          </select>
        </label>
        <label><b>Základ:</b>
          <select id="base">
            <option value="10">DEC</option>
            <option value="16">HEX</option>
            <option value="2">BIN</option>
          </select>
        </label>
        <label><b>Oddělovač:</b>
          <input id="sep" type="text" value=" " size="4" title="Oddělovač mezi hodnotami">
        </label>
        <label><input type="checkbox" id="prefix"> Prefixy (0x/0b)</label>
        <label><input type="checkbox" id="pad"> Zero-padding (HEX=2, BIN=8)</label>
      </div>
    </div>

      <div class="row">
        <div class="card stack">
          <h3>Text → Kódy</h3>
          <textarea id="textIn" class="form-control" placeholder="Zadej text (čeština i emoji fungují v režimu UTF-8)…"></textarea>
          <div class="controls form-inline">
            <button id="toCodes">Převést</button>
            <button id="copyCodes" class="pill">Kopírovat</button>
            <button id="clearText">Vymazat</button>
          </div>
          <textarea id="codesOut" class="form-control" placeholder="Výstupní kódy…" readonly></textarea>
          <div class="small" id="noteText"></div>
        </div>

        <div class="card stack">
          <h3>Kódy → Text</h3>
          <textarea id="codesIn" class="form-control" placeholder="Zadej čísla (např. DEC: 65 66 67, HEX: 0x41 0x42, BIN: 01000001 …). Oddělovač je definovaný výše."></textarea>
          <div class="controls form-inline">
            <button id="toText">Převést</button>
            <button id="copyText" class="pill">Kopírovat</button>
            <button id="clearCodes">Vymazat</button>
          </div>
          <textarea id="textOut" class="form-control" placeholder="Dekódovaný text…" readonly></textarea>
          <div class="small" id="noteCodes"></div>
        </div>
      </div>

      <div class="card">
        <h3>Tipy</h3>
        <ul class="small">
          <li><b>ASCII režim:</b> znaky s kódem &gt;127 se nahradí <code>?</code> (kod 63).</li>
          <li><b>UTF-8 režim:</b> text se převádí na bajty (0–255). HEX s paddingem = hezké <code>0x41 0xC4 0x8D…</code></li>
          <li><b>Vstup kódů:</b> rozdělení probíhá podle tvého oddělovače i whitespace/čárek; prefixy <code>0x</code>/<code>0b</code> jsou povolené.</li>
        </ul>
      </div>
    </div>

    <script type="module">
      import {
        formatNumber,
        parseToken,
        toAsciiCodes,
        toUtf8Bytes,
        bytesToUtf8,
        splitBySep
      } from '../js/encoding.js';

      // --- Helpers ---
      const $ = id => document.getElementById(id);
      const modeEl = $('mode'), baseEl = $('base'), sepEl = $('sep'), prefixEl = $('prefix'), padEl = $('pad');
      const textIn = $('textIn'), codesOut = $('codesOut'), noteText = $('noteText');
      const codesIn = $('codesIn'), textOut = $('textOut'), noteCodes = $('noteCodes');

      // --- Text -> Codes ---
      $('toCodes').addEventListener('click', () => {
        const mode = modeEl.value;
        const base = Number(baseEl.value);
        const sep = sepEl.value;
        const usePrefix = prefixEl.checked;
        const usePad = padEl.checked;

        let nums = [];
        let note = '';
        if (mode === 'ascii') {
          const { codes, replaced } = toAsciiCodes(textIn.value);
          nums = codes;
          if (replaced) note = `Pozn.: ${replaced} znaků mimo ASCII bylo nahrazeno '?' (63).`;
        } else {
          nums = toUtf8Bytes(textIn.value);
        }

        const out = nums.map(n => formatNumber(n, base, usePrefix, usePad)).join(sep || ' ');
        codesOut.value = out;
        noteText.textContent = note;
      });

      $('copyCodes').addEventListener('click', async () => {
        await navigator.clipboard.writeText(codesOut.value || '');
      });

      $('clearText').addEventListener('click', () => {
        textIn.value = ''; codesOut.value = ''; noteText.textContent = '';
      });

      // --- Codes -> Text ---
      $('toText').addEventListener('click', () => {
        const mode = modeEl.value;
        const base = Number(baseEl.value);
        const sep = sepEl.value;

        const toks = splitBySep(codesIn.value, sep);
        const nums = [];
        let invalid = 0;

        for (const t of toks) {
          const n = parseToken(t, base);
          if (n === null || !Number.isFinite(n)) { invalid++; continue; }
          if (mode === 'ascii') {
            if (n < 0 || n > 127) { invalid++; continue; }
            nums.push(n);
          } else {
            // utf8 bytes
            if (n < 0 || n > 255) { invalid++; continue; }
            nums.push(n);
          }
        }

        let text = '';
        if (mode === 'ascii') {
          text = String.fromCharCode(...nums);
        } else {
          text = bytesToUtf8(nums);
        }
        textOut.value = text;
        noteCodes.textContent = invalid ? `Pozn.: ${invalid} neplatných položek ignorováno.` : '';
      });

      $('copyText').addEventListener('click', async () => {
        await navigator.clipboard.writeText(textOut.value || '');
      });

      $('clearCodes').addEventListener('click', () => {
        codesIn.value = ''; textOut.value = ''; noteCodes.textContent = '';
      });

      // Live převod (volitelné – můžeš zakomentovat)
      textIn.addEventListener('input', () => $('toCodes').click());
      codesIn.addEventListener('input', () => $('toText').click());
    </script>
</body>
</html>
