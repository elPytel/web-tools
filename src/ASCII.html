<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>Text ⇄ ASCII / UTF-8 převodník</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root { --pad: 14px; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
           margin: 0; padding: 24px; background: #f7f7f8; color: #111; }
    .app { max-width: 1000px; margin: 0 auto; display: grid; gap: 16px; }
    h1 { margin: 0 0 8px; font-size: 28px; }
    .card { background: #fff; border-radius: 16px; padding: var(--pad);
            box-shadow: 0 6px 20px rgba(0,0,0,.06); }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  textarea { box-sizing: border-box; width: 100%; max-width: 100%; min-height: 140px; max-height: 360px; font-size: 16px; line-height: 1.4;
         padding: 12px; border-radius: 10px; border: 1px solid #ddd; resize: vertical; background: #fafafa; overflow: auto;
         white-space: pre-wrap; word-wrap: break-word; overflow-wrap: anywhere; }
  input[type="text"] { box-sizing: border-box; max-width: 100%; padding: 8px; border-radius: 10px; border: 1px solid #ddd; background: #fafafa; }
    .controls { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    .controls > * { margin: 4px 0; }
    .stack { display: grid; gap: 8px; }
    button { border: 1px solid #dadada; background: #fff; padding: 8px 12px;
             border-radius: 10px; cursor: pointer; font-size: 14px;
             box-shadow: 0 2px 6px rgba(0,0,0,.05); }
    button:hover { background: #f1f1f1; }
    .pill { padding: 4px 10px; border-radius: 999px; font-size: 13px; background:#f0f3ff; border-color:#cfd8ff; }
    .small { font-size: 12px; color: #555; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { padding: 6px 8px; border-bottom: 1px solid #eee; text-align: left; }
    @media (max-width: 900px) { .row { grid-template-columns: 1fr; } }
    code { background: #f3f3f3; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <h1>Text ⇄ ASCII / UTF-8</h1>
      <div class="small">
        <b>Režim:</b> <code>ASCII</code> nahrazuje znaky &gt;127 za <code>?</code>. <code>UTF-8</code> převádí text na sekvenci bajtů (funguje pro češtinu i emoji).
      </div>
    </div>

    <div class="card">
      <div class="controls">
        <label><b>Režim:</b>
          <select id="mode">
            <option value="ascii">ASCII (0–127)</option>
            <option value="utf8">UTF-8 (bajty)</option>
          </select>
        </label>
        <label><b>Základ:</b>
          <select id="base">
            <option value="10">DEC</option>
            <option value="16">HEX</option>
            <option value="2">BIN</option>
          </select>
        </label>
        <label><b>Oddělovač:</b>
          <input id="sep" type="text" value=" " size="4" title="Oddělovač mezi hodnotami">
        </label>
        <label><input type="checkbox" id="prefix"> Prefixy (0x/0b)</label>
        <label><input type="checkbox" id="pad"> Zero-padding (HEX=2, BIN=8)</label>
      </div>
    </div>

    <div class="row">
      <div class="card stack">
        <h3>Text → Kódy</h3>
        <textarea id="textIn" placeholder="Zadej text (čeština i emoji fungují v režimu UTF-8)…"></textarea>
        <div class="controls">
          <button id="toCodes">Převést</button>
          <button id="copyCodes" class="pill">Kopírovat</button>
          <button id="clearText">Vymazat</button>
        </div>
        <textarea id="codesOut" placeholder="Výstupní kódy…" readonly></textarea>
        <div class="small" id="noteText"></div>
      </div>

      <div class="card stack">
        <h3>Kódy → Text</h3>
        <textarea id="codesIn" placeholder="Zadej čísla (např. DEC: 65 66 67, HEX: 0x41 0x42, BIN: 01000001 …). Oddělovač je definovaný výše."></textarea>
        <div class="controls">
          <button id="toText">Převést</button>
          <button id="copyText" class="pill">Kopírovat</button>
          <button id="clearCodes">Vymazat</button>
        </div>
        <textarea id="textOut" placeholder="Dekódovaný text…" readonly></textarea>
        <div class="small" id="noteCodes"></div>
      </div>
    </div>

    <div class="card">
      <h3>Tipy</h3>
      <ul class="small">
        <li><b>ASCII režim:</b> znaky s kódem &gt;127 se nahradí <code>?</code> (kod 63).</li>
        <li><b>UTF-8 režim:</b> text se převádí na bajty (0–255). HEX s paddingem = hezké <code>0x41 0xC4 0x8D…</code></li>
        <li><b>Vstup kódů:</b> rozdělení probíhá podle tvého oddělovače i whitespace/čárek; prefixy <code>0x</code>/<code>0b</code> jsou povolené.</li>
      </ul>
    </div>
  </div>

  <script>
    // --- Helpers ---
    const $ = id => document.getElementById(id);
    const modeEl = $('mode'), baseEl = $('base'), sepEl = $('sep'), prefixEl = $('prefix'), padEl = $('pad');
    const textIn = $('textIn'), codesOut = $('codesOut'), noteText = $('noteText');
    const codesIn = $('codesIn'), textOut = $('textOut'), noteCodes = $('noteCodes');

    function formatNumber(n, base, usePrefix, pad) {
      let s = n.toString(base).toUpperCase();
      if (pad) {
        const width = base === 16 ? 2 : (base === 2 ? 8 : 0);
        if (width) s = s.padStart(width, '0');
      }
      if (usePrefix) {
        if (base === 16) s = '0x' + s;
        if (base === 2)  s = '0b' + s;
      }
      return s;
    }

    function parseToken(tok, base) {
      let t = tok.trim();
      if (!t) return null;
      // podpora 0x / 0b i když máš nastavený jiný base
      if (/^0x/i.test(t)) return parseInt(t, 16);
      if (/^0b/i.test(t)) return parseInt(t.slice(2), 2);
      // jinak použij zvolený base
      const n = parseInt(t, base);
      return Number.isFinite(n) ? n : null;
    }

    function toAsciiCodes(str) {
      const codes = [];
      let replaced = 0;
      for (const ch of str) {
        let cp = ch.codePointAt(0);
        if (cp > 127) { cp = 63; replaced++; } // '?'
        codes.push(cp);
      }
      return { codes, replaced };
    }

    function toUtf8Bytes(str) {
      const enc = new TextEncoder();
      return Array.from(enc.encode(str)); // 0..255
    }

    function bytesToUtf8(bytes) {
      try {
        const dec = new TextDecoder('utf-8', { fatal: true });
        return dec.decode(new Uint8Array(bytes));
      } catch {
        // pokud sekvence nedává smysl, zkus bez fatal
        return new TextDecoder('utf-8').decode(new Uint8Array(bytes));
      }
    }

    function splitBySep(str, sep) {
      if (!str.trim()) return [];
      // rozděluj podle: explicitního oddělovače, whitespace, nebo čárek
      const esc = sep ? sep.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') : '';
      const re = esc ? new RegExp(`\\s*${esc}\\s*|\\s+|,\\s*`, 'g') : /\s+|,\s*/g;
      return str.split(re).filter(Boolean);
    }

    // --- Text -> Codes ---
    $('toCodes').addEventListener('click', () => {
      const mode = modeEl.value;
      const base = Number(baseEl.value);
      const sep = sepEl.value;
      const usePrefix = prefixEl.checked;
      const usePad = padEl.checked;

      let nums = [];
      let note = '';
      if (mode === 'ascii') {
        const { codes, replaced } = toAsciiCodes(textIn.value);
        nums = codes;
        if (replaced) note = `Pozn.: ${replaced} znaků mimo ASCII bylo nahrazeno '?' (63).`;
      } else {
        nums = toUtf8Bytes(textIn.value);
      }

      const out = nums.map(n => formatNumber(n, base, usePrefix, usePad)).join(sep || ' ');
      codesOut.value = out;
      noteText.textContent = note;
    });

    $('copyCodes').addEventListener('click', async () => {
      await navigator.clipboard.writeText(codesOut.value || '');
    });

    $('clearText').addEventListener('click', () => {
      textIn.value = ''; codesOut.value = ''; noteText.textContent = '';
    });

    // --- Codes -> Text ---
    $('toText').addEventListener('click', () => {
      const mode = modeEl.value;
      const base = Number(baseEl.value);
      const sep = sepEl.value;

      const toks = splitBySep(codesIn.value, sep);
      const nums = [];
      let invalid = 0;

      for (const t of toks) {
        const n = parseToken(t, base);
        if (n === null || !Number.isFinite(n)) { invalid++; continue; }
        if (mode === 'ascii') {
          if (n < 0 || n > 127) { invalid++; continue; }
          nums.push(n);
        } else {
          // utf8 bytes
          if (n < 0 || n > 255) { invalid++; continue; }
          nums.push(n);
        }
      }

      let text = '';
      if (mode === 'ascii') {
        text = String.fromCharCode(...nums);
      } else {
        text = bytesToUtf8(nums);
      }
      textOut.value = text;
      noteCodes.textContent = invalid ? `Pozn.: ${invalid} neplatných položek ignorováno.` : '';
    });

    $('copyText').addEventListener('click', async () => {
      await navigator.clipboard.writeText(textOut.value || '');
    });

    $('clearCodes').addEventListener('click', () => {
      codesIn.value = ''; textOut.value = ''; noteCodes.textContent = '';
    });

    // Live převod (volitelné – můžeš zakomentovat)
    textIn.addEventListener('input', () => $('toCodes').click());
    codesIn.addEventListener('input', () => $('toText').click());
  </script>
</body>
</html>
