<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="google-site-verification" content="Dm-OxdKOqxXU8Xl-P-cM__TW_maaC1rbINMEEu7HyWU" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Web Tools ‚Äî domov</title>
  <link rel="stylesheet" href="./css/style.css">
  <style>
    /* default (night) variables */
    :root { --card-bg:#111a22; --card-border:#223142; --muted:#8aa0b2; --hover:#0f2238; }

    /* explicit theme classes set by js/theme.js (takes precedence) */
    body.day {
      --card-border:#d7e1ee;
      --muted:#556981;
      --hover:#eef5ff;
    }
    body.night {
      --card-border:#223142;
      --muted:#8aa0b2;
      --hover:#0f2238;
    }
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; max-width:1100px; margin:3rem auto; padding:1rem; }

    .search { flex:1 1 320px; min-width:220px; border:1px solid var(--card-border); border-radius:10px; padding:.6rem .8rem; background:var(--card-bg) }
  .chip { border:1px solid var(--card-border); border-radius:999px; padding:.35rem .7rem; font-size:.9rem; background:var(--card-bg); cursor:pointer; user-select:none }
  /* Theme-aware chip pressed state (overrides when theme.js sets body.day/night) */
  body.day .chip[aria-pressed="true"] { background:#eef5ff }
  body.night .chip[aria-pressed="true"] { background:#1b2a40 }

  .category { margin:1.4rem 0 2.2rem }
  .category h2 { margin:0 0 .6rem 0 }
    
  /* Grid: keep cards equal width (2-3 per row) and don't let them stretch too wide.
     Use auto-fill with a fixed max column width so columns don't expand to fill remaining space
     and stay left-aligned when there are 2 columns (they won't center). */
  .grid { display:grid; gap:1rem; grid-template-columns: repeat(auto-fill, minmax(280px, 340px)); justify-content:start }
  .grid > article.card { width:100%; max-width:340px; justify-self:start }

  /* On very small viewports, use a single column */
  @media (max-width: 640px) {
    .grid { grid-template-columns: 1fr }
    .grid > article.card { max-width: none }
  }

  .card { position:relative; padding:1rem 1rem 3.25rem 1rem; border:1px solid var(--card-border); border-radius:12px; background:var(--card-bg); transition: transform .08s, background .12s, border-color .12s }
    .card:hover { transform: translateY(-1px); background: var(--hover); }
    .card h3 { margin:.2rem 0 .25rem 0 }
    .card p { margin:0; color:var(--muted) }
  .card .tags { margin-top:.5rem; margin-bottom:1rem; display:flex; gap:.35rem; flex-wrap:wrap }
    .tag { font-size:.75rem; padding:.15rem .45rem; border-radius:999px; border:1px solid var(--card-border) }
    .open { position:absolute; left:1rem; bottom:1rem; display:inline-block; padding:.45rem .65rem; background:#0366d6; color:#fff; text-decoration:none; border-radius:6px }
    .meta { position:absolute; right:1rem; bottom:1rem; color: var(--muted); font-size:.9rem }
    footer { margin-top:2rem; color:#666; font-size:.9rem }
    .empty { color:var(--muted); padding:.8rem 0 }
  </style>
</head>
<body>
  <script type="module" src="./js/ui/site-header.js"></script>
  <site-header title="Web Tools"></site-header>

    <p class="lead">Mal√© n√°stroje spustiteln√© v prohl√≠≈æeƒçi. Vyberte si jednu z aplikac√≠ n√≠≈æe.</p>
    <div class="toolbar">
      <input id="q" class="search" type="search" placeholder="Hledat (n√°zev, popis, tagy)‚Ä¶" aria-label="Hledat">
      <div id="chips" class="chips" aria-label="Kategorie"><!-- generated category chips will go here --></div>
    </div>

  <main id="root"></main>

  <footer>&copy; <span id="year"></span> Web Tools</footer>

  <script type="module">
    const $ = (s, r=document)=>r.querySelector(s);
    const $$ = (s, r=document)=>[...r.querySelectorAll(s)];
    $('#year').textContent = new Date().getFullYear();

    const STATE = { q:'', cat:'all', data:null };

    async function load() {
      try {
        const res = await fetch('./tools.json', {cache:'no-store'});
        STATE.data = await res.json();
      } catch (e) {
        console.error('Nelze naƒç√≠st tools.json', e);
        STATE.data = { categories: [] };
      }
      render();
    }

    function toolMatches(tool) {
      const q = STATE.q.trim().toLowerCase();
      if (!q) return true;
      const hay = `${tool.name} ${tool.desc||''} ${(tool.tags||[]).join(' ')}`.toLowerCase();
      return hay.includes(q);
    }

    function render() {
      const root = $('#root');
      root.innerHTML = '';

      const cats = (STATE.data.categories||[]).filter(c => STATE.cat==='all' ? true : c.id===STATE.cat);

      let any=false;
      for (const cat of cats) {
        const visibleTools = (cat.tools||[]).filter(toolMatches);
        if (!visibleTools.length) continue;
        any = true;

        const sec = document.createElement('section');
        sec.className = 'category';
        sec.innerHTML = `<h2>${cat.name}</h2><div class="grid"></div>`;
        const grid = $('.grid', sec);

        visibleTools.forEach(t=>{
          const el = document.createElement('article');
          el.className = 'card';
          el.innerHTML = `
            <h3>${t.name} ${t.difficulty||''}</h3>
            <p>${t.desc||''}</p>
            ${t.tags?.length ? `<div class="tags">${t.tags.map(x=>`<span class="tag">${x}</span>`).join('')}</div>` : ''}
            <a class="open" href="${t.path}">Otev≈ô√≠t</a>
            <span class="meta">${t.hasExplain ? 'üìò' : ''}</span>
          `;
          grid.appendChild(el);
        });

        root.appendChild(sec);
      }

      if (!any) {
        root.innerHTML = `<p class="empty">Nenalezeny ≈æ√°dn√© n√°stroje ‚Äî zmƒõ≈à filtr nebo hledan√Ω v√Ωraz.</p>`;
      }
    }

    // Ud√°losti
    $('#q').addEventListener('input', e => { STATE.q = e.target.value; render(); });

    // Chips: generate from STATE.data and use event delegation for clicks
    function generateChips() {
      const container = document.getElementById('chips');
      if (!container) return;
      container.innerHTML = '';
      // add "all" button
      const allBtn = document.createElement('button');
      allBtn.className = 'chip'; allBtn.dataset.cat = 'all'; allBtn.setAttribute('aria-pressed','true');
      allBtn.type = 'button'; allBtn.textContent = 'V≈°e';
      container.appendChild(allBtn);

      const cats = (STATE.data && STATE.data.categories) ? STATE.data.categories : [];
      for (const cat of cats) {
        const btn = document.createElement('button');
        btn.className = 'chip'; btn.type = 'button'; btn.dataset.cat = cat.id;
        btn.textContent = (cat.chip || cat.name || cat.id);
        btn.setAttribute('aria-pressed','false');
        container.appendChild(btn);
      }
    }

    // Delegate clicks on chips
    const chipsContainer = document.getElementById('chips');
    if (chipsContainer) {
      chipsContainer.addEventListener('click', e => {
        const ch = e.target.closest('.chip');
        if (!ch) return;
        chipsContainer.querySelectorAll('.chip').forEach(c=>c.setAttribute('aria-pressed','false'));
        ch.setAttribute('aria-pressed','true');
        STATE.cat = ch.dataset.cat;
        render();
      });
    }

    // load data and then generate chips + render
    load().then(()=>{ generateChips(); render(); });
  </script>
  <script type="module">
    // Theme wiring: initialize theme manager and sync header radios
    import { initTheme, applyTheme } from './js/ui/theme.js';
    initTheme();

    const stored = localStorage.getItem('site_theme_mode') || 'auto';
    const radios = document.querySelectorAll('#themeControls input[name="theme"]');
    radios.forEach(r => r.checked = (r.value === stored));

    document.getElementById('themeControls').addEventListener('change', e => {
      if (e.target && e.target.value) applyTheme(e.target.value);
    });

    // keep radios synced when theme changes elsewhere
    window.addEventListener('theme:changed', ev => {
      const requested = ev.detail && ev.detail.requested ? ev.detail.requested : (localStorage.getItem('site_theme_mode') || 'auto');
      radios.forEach(r => r.checked = (r.value === requested));
    });
    window.addEventListener('storage', ev => {
      if (ev.key === 'site_theme_mode') {
        radios.forEach(r => r.checked = (r.value === (ev.newValue || 'auto')));
      }
    });
  </script>
</body>
</html>
