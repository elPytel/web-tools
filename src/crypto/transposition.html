<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <title>ğŸ”€ TranspoziÄnÃ­ Å¡ifra â€“ nÃ¡stroj</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .controls { display:grid; gap:10px }
    textarea { min-height:120px }
    .row { display:flex; flex-wrap:wrap; gap:8px; align-items:center }
    .small-input { max-width:120px }
    .select { max-width:180px }
    .muted { color: var(--muted); font-size:.9rem }
    .result { white-space:pre-wrap; word-break:break-word }
  </style>
</head>
<body>
<div class="app">
  <script type="module" src="../js/ui/site-header.js"></script>
  <site-header title="ğŸ”€ TranspoziÄnÃ­ Å¡ifra"></site-header>

  <div class="card">
    <p class="muted">
      TranspoziÄnÃ­ Å¡ifra mÄ›nÃ­ <strong>poÅ™adÃ­ znakÅ¯</strong>, ale nemÄ›nÃ­ samotnÃ¡ pÃ­smena.  
      Zvol klÃ­Ä, smÄ›r zÃ¡pisu a ÄtenÃ­, pÅ™Ã­padnÄ› dvojitou transpozici.
    </p>

    <div class="controls">
      <label>
        VstupnÃ­ text:
        <textarea id="input" class="form-control" placeholder="Zadej text k zaÅ¡ifrovÃ¡nÃ­ / deÅ¡ifrovÃ¡nÃ­..."></textarea>
      </label>

      <div class="row">
        <label>KlÃ­Ä 1:
          <input id="key1" type="text" class="form-control small-input" placeholder="KLÃC1" />
        </label>
        <label>KlÃ­Ä 2:
          <input id="key2" type="text" class="form-control small-input" placeholder="KLÃC2 (pro dvojitou)" />
        </label>
        <label>DoplÅˆovacÃ­ znak:
          <input id="padChar" type="text" class="form-control small-input" value="X" maxlength="1" />
        </label>
      </div>

      <div class="row">
        <label>ZÃ¡pis do tabulky:
          <select id="fillMode" class="form-control select">
            <option value="row-lr">Å˜Ã¡dky zleva doprava</option>
            <option value="row-rl">Å˜Ã¡dky zprava doleva</option>
            <option value="col-tb">Sloupce shora dolÅ¯</option>
            <option value="col-bt">Sloupce zdola nahoru</option>
          </select>
        </label>
        <label>ÄŒtenÃ­ z tabulky:
          <select id="readMode" class="form-control select">
            <option value="col-tb">Sloupce shora dolÅ¯</option>
            <option value="col-bt">Sloupce zdola nahoru</option>
            <option value="row-lr">Å˜Ã¡dky zleva doprava</option>
            <option value="row-rl">Å˜Ã¡dky zprava doleva</option>
          </select>
        </label>
      </div>

      <div class="row">
        <label><input id="double" type="checkbox" /> dvojitÃ¡ transpozice (pouÅ¾ij klÃ­Ä 1 a 2)</label>
        <label><input id="normalize" type="checkbox" /> normalizovat (Aâ€“Z, bez mezer/diakritiky)</label>
        <label><input id="lettersOnly" type="checkbox" /> transponovat jen pÃ­smena (mezery a interpunkce zÅ¯stanou)</label>
      </div>

      <div class="row" style="justify-content:center; margin-top:4px;">
        <button id="btnEnc" class="btn primary">ZaÅ¡ifrovat</button>
        <button id="btnDec" class="btn">DeÅ¡ifrovat</button>
      </div>

      <div>
        <label>VÃ½sledek:
          <textarea id="output" class="form-control result" readonly placeholder="Zde se zobrazÃ­ vÃ½sledek..."></textarea>
        </label>
      </div>
    </div>

    <p class="muted" style="margin-top:8px;">
      Tip: zapni <code>dvojitou transpozici</code> a zmÄ›Åˆ smÄ›r zÃ¡pisu nebo ÄtenÃ­.  
      Sleduj, jak hodnÄ› se Å¡ifrotext liÅ¡Ã­ od pÅ¯vodnÃ­ho textu.
    </p>
  </div>

  <script type="module" src="../js/site-doc.js"></script>
    <site-doc src="transposition_explain.md" title="ğŸ“˜ VysvÄ›tlenÃ­" toggle></site-doc>
</div>

<script type="module">
  import { transposeEncrypt, transposeDecrypt } from '../js/tools/crypto/transposition.js';

  const $ = sel => document.querySelector(sel);

  const inputEl      = $('#input');
  const outputEl     = $('#output');
  const key1El       = $('#key1');
  const key2El       = $('#key2');
  const padCharEl    = $('#padChar');
  const fillModeEl   = $('#fillMode');
  const readModeEl   = $('#readMode');
  const doubleEl     = $('#double');
  const normalizeEl  = $('#normalize');
  const lettersOnlyEl= $('#lettersOnly');
  const btnEnc       = $('#btnEnc');
  const btnDec       = $('#btnDec');

  function getOptions() {
    const key1 = key1El.value || '';
    const key2 = key2El.value || '';
    const pad  = padCharEl.value || 'X';

    return {
      key1,
      key2,
      double: !!doubleEl.checked,
      fillMode: fillModeEl.value,
      readMode: readModeEl.value,
      padChar: pad[0],
      normalize: !!normalizeEl.checked,
      lettersOnly: !!lettersOnlyEl.checked
    };
  }

  btnEnc.addEventListener('click', () => {
    const text = inputEl.value || '';
    const opts = getOptions();

    // pokud je normalize zapnutÃ©, lettersOnly nedÃ¡vÃ¡ smysl â†’ ignorujeme ho
    if (opts.normalize) {
      opts.lettersOnly = false;
    }

    const res = transposeEncrypt(text, opts);
    outputEl.value = res;
  });

  btnDec.addEventListener('click', () => {
    const text = inputEl.value || '';
    const opts = getOptions();

    if (opts.normalize) {
      // deÅ¡ifrovÃ¡nÃ­ normalizovanÃ©ho textu â€“ vÃ½sledek bude takÃ© bez mezer/diakritiky
      opts.lettersOnly = false;
    }

    const res = transposeDecrypt(text, opts);
    outputEl.value = res;
  });
</script>
</body>
</html>
