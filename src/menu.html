<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Web Tools ‚Äî domov</title>
  <link rel="stylesheet" href="./css/style.css">
  <style>
    /* default (night) variables */
    :root { --card-bg:#111a22; --card-border:#223142; --muted:#8aa0b2; --hover:#0f2238; }

    /* explicit theme classes set by js/theme.js (takes precedence) */
    body.day {
      --card-bg:#fff;
      --card-border:#d7e1ee;
      --muted:#556981;
      --hover:#eef5ff;
    }
    body.night {
      --card-bg:#111a22;
      --card-border:#223142;
      --muted:#8aa0b2;
      --hover:#0f2238;
    }

    /* keep the prefers-color-scheme fallback for browsers without theme toggling */
    @media (prefers-color-scheme: light){
      :root { --card-bg:#fff; --card-border:#d7e1ee; --muted:#556981; --hover:#eef5ff; }
    }
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; max-width:1100px; margin:3rem auto; padding:1rem; }
    /* header layout: top row with title on left and controls on right */
    header { margin-bottom:1rem; }
    .header-top { display:flex; align-items:center; justify-content:space-between; gap:1rem; }
    .header-left { display:flex; flex-direction:column; }
    .lead { color: var(--muted); }

    .toolbar { display:flex; gap:.6rem; flex-wrap:wrap; align-items:center; margin-top:.25rem }
    .search { flex:1 1 320px; min-width:220px; border:1px solid var(--card-border); border-radius:10px; padding:.6rem .8rem; background:var(--card-bg) }
    .chip { border:1px solid var(--card-border); border-radius:999px; padding:.35rem .7rem; font-size:.9rem; background:var(--card-bg); cursor:pointer; user-select:none }
    .chip[aria-pressed="true"] { background:#1b2a40 }
    @media (prefers-color-scheme: light){ .chip[aria-pressed="true"]{ background:#eef5ff } }

    .category { margin:1.4rem 0 2.2rem }
    .category h2 { margin:0 0 .6rem 0 }
    .grid { display:grid; gap:16px; grid-template-columns: repeat(auto-fit, minmax(260px,1fr)); }
    .card { position:relative; padding:1rem 1rem 3.25rem 1rem; border:1px solid var(--card-border); border-radius:12px; background:var(--card-bg); transition: transform .08s, background .12s, border-color .12s }
    .card:hover { transform: translateY(-1px); background: var(--hover); }
    .card h3 { margin:.2rem 0 .25rem 0 }
    .card p { margin:0; color:var(--muted) }
    .card .tags { margin-top:.5rem; display:flex; gap:.35rem; flex-wrap:wrap }
    .tag { font-size:.75rem; padding:.15rem .45rem; border-radius:999px; border:1px solid var(--card-border) }
    .open { position:absolute; left:1rem; bottom:1rem; display:inline-block; padding:.45rem .65rem; background:#0366d6; color:#fff; text-decoration:none; border-radius:6px }
    .meta { position:absolute; right:1rem; bottom:1rem; color: var(--muted); font-size:.9rem }
    footer { margin-top:2rem; color:#666; font-size:.9rem }
    .empty { color:var(--muted); padding:.8rem 0 }
  </style>
</head>
<body>
  <header>
    <h1>Web Tools</h1>
    <!-- Theme controls (day/auto/night) -->
      <div class="theme-toggle" id="themeControls" style="margin-left:auto">
        <label><input type="radio" name="theme" value="auto"> Auto</label>
        <label><input type="radio" name="theme" value="day"> Den</label>
        <label><input type="radio" name="theme" value="night"> Noc</label>
      </div>
    <p class="lead">Mal√© n√°stroje spustiteln√© v prohl√≠≈æeƒçi. Vyberte si jednu z aplikac√≠ n√≠≈æe.</p>
    <div class="toolbar">
      <input id="q" class="search" type="search" placeholder="Hledat (n√°zev, popis, tagy)‚Ä¶" aria-label="Hledat">
      <button class="chip" data-cat="all" aria-pressed="true">V≈°e</button>
      <button class="chip" data-cat="time">‚è±Ô∏è ƒåas</button>
      <button class="chip" data-cat="fitness">üèÉ‚Äç‚ôÄÔ∏è Tr√©ninky</button>
      <button class="chip" data-cat="encoding">üßÆ K√≥dov√°n√≠</button>
      <button class="chip" data-cat="crypto">üîê Kryptografie</button>
      <button class="chip" data-cat="analysis">üß† Anal√Ωza</button>
      
    </div>
  </header>

  <main id="root"></main>

  <footer>&copy; <span id="year"></span> Web Tools</footer>

  <script type="module">
    const $ = (s, r=document)=>r.querySelector(s);
    const $$ = (s, r=document)=>[...r.querySelectorAll(s)];
    $('#year').textContent = new Date().getFullYear();

    const STATE = { q:'', cat:'all', data:null };

    async function load() {
      try {
        const res = await fetch('./tools.json', {cache:'no-store'});
        STATE.data = await res.json();
      } catch (e) {
        console.error('Nelze naƒç√≠st tools.json', e);
        STATE.data = { categories: [] };
      }
      render();
    }

    function toolMatches(tool) {
      const q = STATE.q.trim().toLowerCase();
      if (!q) return true;
      const hay = `${tool.name} ${tool.desc||''} ${(tool.tags||[]).join(' ')}`.toLowerCase();
      return hay.includes(q);
    }

    function render() {
      const root = $('#root');
      root.innerHTML = '';

      const cats = (STATE.data.categories||[]).filter(c => STATE.cat==='all' ? true : c.id===STATE.cat);

      let any=false;
      for (const cat of cats) {
        const visibleTools = (cat.tools||[]).filter(toolMatches);
        if (!visibleTools.length) continue;
        any = true;

        const sec = document.createElement('section');
        sec.className = 'category';
        sec.innerHTML = `<h2>${cat.name}</h2><div class="grid"></div>`;
        const grid = $('.grid', sec);

        visibleTools.forEach(t=>{
          const el = document.createElement('article');
          el.className = 'card';
          el.innerHTML = `
            <h3>${t.name} ${t.difficulty||''}</h3>
            <p>${t.desc||''}</p>
            ${t.tags?.length ? `<div class="tags">${t.tags.map(x=>`<span class="tag">${x}</span>`).join('')}</div>` : ''}
            <a class="open" href="${t.path}">Otev≈ô√≠t</a>
            <span class="meta">${t.hasExplain ? 'üìò' : ''}</span>
          `;
          grid.appendChild(el);
        });

        root.appendChild(sec);
      }

      if (!any) {
        root.innerHTML = `<p class="empty">Nenalezeny ≈æ√°dn√© n√°stroje ‚Äî zmƒõ≈à filtr nebo hledan√Ω v√Ωraz.</p>`;
      }
    }

    // Ud√°losti
    $('#q').addEventListener('input', e => { STATE.q = e.target.value; render(); });
    $$('.chip').forEach(ch => ch.addEventListener('click', ()=>{
      $$('.chip').forEach(c=>c.setAttribute('aria-pressed','false'));
      ch.setAttribute('aria-pressed','true');
      STATE.cat = ch.dataset.cat;
      render();
    }));

    load();
  </script>
  <script type="module">
    // Theme wiring: initialize theme manager and sync header radios
    import { initTheme, applyTheme } from './js/theme.js';
    initTheme();

    const stored = localStorage.getItem('site_theme_mode') || 'auto';
    const radios = document.querySelectorAll('#themeControls input[name="theme"]');
    radios.forEach(r => r.checked = (r.value === stored));

    document.getElementById('themeControls').addEventListener('change', e => {
      if (e.target && e.target.value) applyTheme(e.target.value);
    });

    // keep radios synced when theme changes elsewhere
    window.addEventListener('theme:changed', ev => {
      const requested = ev.detail && ev.detail.requested ? ev.detail.requested : (localStorage.getItem('site_theme_mode') || 'auto');
      radios.forEach(r => r.checked = (r.value === requested));
    });
    window.addEventListener('storage', ev => {
      if (ev.key === 'site_theme_mode') {
        radios.forEach(r => r.checked = (r.value === (ev.newValue || 'auto')));
      }
    });
  </script>
</body>
</html>
