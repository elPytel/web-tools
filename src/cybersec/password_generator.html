<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <title>üîê Gener√°tor bezpeƒçn√Ωch hesel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="../css/style.css" />
  <style>
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    .pw { font-size: 1.05rem; letter-spacing: .02em; }
    .pw-list { display: grid; gap: 8px; }
    .pw-row { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; }
    .hint { color: var(--muted); font-size: .9rem; }
    .small { font-size: .9rem; }
    .ok { color: var(--success); }
    .warn { color: var(--warning); }
    .bad { color: var(--danger); }
    .kbd { padding: 2px 6px; border:1px solid var(--border); border-radius: 6px; background: var(--panel-2); }
    .grid2 { display:grid; gap:12px; grid-template-columns: repeat(2, minmax(0,1fr)); }
    @media (max-width: 880px){ .grid2 { grid-template-columns: 1fr; } }
    .tag { border:1px solid var(--border); border-radius:999px; padding:.1rem .5rem; font-size:.8rem; }
  </style>
</head>
<body>
  <div class="app">
    <script type="module" src="../js/ui/site-header.js"></script>
    <site-header title="üîê Gener√°tor bezpeƒçn√Ωch hesel"></site-header>

    <!-- Karta 1: Generov√°n√≠ -->
    <section class="card">
      <h2>Generov√°n√≠ hesla</h2>
      <p class="muted">Vygeneruj n√°hodn√° siln√° hesla dle zvolen√Ωch pravidel. V√Ωchoz√≠ poƒçet: 5 hesel.</p>

      <div class="grid2">
        <div class="br p-4">
          <div class="row">
            <label class="row" style="gap:6px">D√©lka:
              <input id="len" type="number" min="4" max="128" value="16" class="small-input" />
            </label>
            <label class="row" style="gap:6px">Poƒçet hesel:
              <input id="count" type="number" min="1" max="100" value="5" class="small-input" />
            </label>
            <span class="right muted small">Tip: <span class="kbd">Enter</span> generuje znovu</span>
          </div>

          <div class="row mt-4" style="gap:18px; flex-wrap:wrap">
            <label><input id="useUpper" type="checkbox" checked /> A‚ÄìZ</label>
            <label><input id="useLower" type="checkbox" checked /> a‚Äìz</label>
            <label><input id="useDigits" type="checkbox" checked /> 0‚Äì9</label>
            <label><input id="useSymbols" type="checkbox" /> #$&amp;‚Ä¶</label>
          </div>

          <div class="row mt-2" style="gap:18px; flex-wrap:wrap">
            <label title="Vynech√° znaky 0 O o 1 l I | ' \ &quot;">
              <input id="avoidAmb" type="checkbox" /> Vyhnout se nejednoznaƒçn√Ωm znak≈Øm
            </label>
            <label title="Zaruƒç√≠ alespo≈à jeden znak z ka≈æd√© vybran√© sady">
              <input id="ensureEach" type="checkbox" checked /> Zaruƒçit zastoupen√≠ v≈°ech zvolen√Ωch sad
            </label>
          </div>

          <div class="row mt-4">
            <button id="btnGen" class="btn primary">Vygenerovat</button>
            <button id="btnCopyAll" class="btn">Kop√≠rovat v≈°e</button>
            <span id="copyHint" class="hint"></span>
          </div>
        </div>

        <div class="br p-4">
          <div class="row" style="justify-content:space-between">
            <h3 class="mb-0">V√Ωsledky</h3>
            <span id="strengthBadge" class="tag">‚Äî</span>
          </div>
          <div id="pwList" class="pw-list mt-2"></div>
          <p id="strengthNote" class="hint mt-2"></p>
        </div>
      </div>
    </section>

    <!-- Karta 2: Kombinace & entropie -->
    <section class="card">
      <h2>Kombinace &amp; entropie</h2>
      <p class="muted">Vypoƒç√≠t√°no z aktu√°ln√≠ konfigurace (vybran√© sady znak≈Ø a d√©lka).</p>
      <div class="grid2">
        <div class="br p-4">
          <ul class="mt-0">
            <li>Velikost abecedy <b id="alphabetSize">0</b> znak≈Ø</li>
            <li>Kombinac√≠: <span class="mono" id="combos">‚Äî</span></li>
            <li>Entropie: <b id="entropyBits">‚Äî</b> bit≈Ø</li>
          </ul>
          <p class="hint small">
            Entropie se poƒç√≠t√° jako <code>L ¬∑ log<sub>2</sub>(N)</code>, kde <code>L</code> je d√©lka a <code>N</code> velikost abecedy.
          </p>
        </div>
        <div class="br p-4">
          <label class="row">Odhad pokus≈Ø za sekundu:
            <input id="rate" type="number" min="1" value="500000000" class="small-input" />
            <span class="hint small">nap≈ô. 5e8 = 500&nbsp;000&nbsp;000 / s</span>
          </label>

          <!-- Nov√© ovl√°dac√≠ prvky pro v√Ωpoƒçet rychlosti -->
          <div class="mt-2">
            <label class="row" style="gap:8px; align-items:center;">
              Re≈æim v√Ωpoƒçtu rychlosti:
              <select id="rateMode" class="small-input">
                <option value="manual">Manu√°ln√≠ (pole v√Ω≈°e)</option>
                <option value="cpu">CPU odhad (frekvence / instrukce)</option>
                <option value="hash">Kryptografick√° funkce (ƒças na hash)</option>
              </select>
            </label>

            <div id="cpuControls" style="margin-top:.5rem; display:none;">
              <label class="row" style="gap:8px; align-items:center;">
                Frekvence CPU (GHz):
                <input id="cpuFreq" type="number" min="0.001" step="0.1" value="5" class="small-input" />
              </label>
              <label class="row" style="gap:8px; align-items:center; margin-top:.25rem;">
                Instrukc√≠ na jedno heslo:
                <input id="instrPerPw" type="number" min="1" step="1" value="10" class="small-input" />
              </label>
              <p class="hint small">Rate ‚âà frekvence(Hz) / instrukce_na_heslo</p>
            </div>

            <div id="hashControls" style="margin-top:.5rem; display:none;">
              <label class="row" style="gap:8px; align-items:center;">
                Preset funkce:
                <select id="hashPreset" class="small-input">
                  <option value="md_fast" data-ms="0.0005">MD5-like (‚âà0.0005 ms)</option>
                  <option value="sha256" data-ms="0.005">SHA-256-like (‚âà0.005 ms)</option>
                  <option value="bcrypt" data-ms="100">bcrypt (‚âà100 ms)</option>
                  <option value="argon2" data-ms="200">argon2 (‚âà200 ms)</option>
                  <option value="custom" data-ms="">Vlastn√≠</option>
                </select>
              </label>
              <label class="row" style="gap:8px; align-items:center; margin-top:.25rem;">
                ƒåas na 1 hash (ms):
                <input id="hashMs" type="number" min="0" step="0.01" value="1" class="small-input" />
              </label>
              <p class="hint small">Rate = 1000 / ms_na_hash (pokus≈Ø/s) ‚Äî nebo se pou≈æije p≈ô√≠mo ƒças na hash pro v√Ωpoƒçet celkov√© doby.</p>
            </div>
          </div>

          <p class="mt-2">Hrub√Ω odhad doby vyƒçerp√°n√≠ prostoru:
            <br><b id="timeCrack">‚Äî</b>
          </p>
          <p class="hint small">Didaktick√Ω odhad (brute-force). Skuteƒçnƒõ z√°le≈æ√≠ na typu hash/KDF, hardwaru a paralelizaci.</p>

          <!-- Kontejner pro p≈ô√≠kladovou tabulku -->
          <div id="exampleTableContainer" class="br p-4 mt-4">
            <h4 class="mb-1">P≈ô√≠klad (podle p≈ôedvoleb)</h4>
            <div style="overflow:auto">
              <table id="exampleTable" style="width:100%; border-collapse:collapse;">
                <!-- rendered by JS -->
              </table>
            </div>
          </div>
        </div>
      </div>
    </section>
  <script type="module" src="../js/site-doc.js"></script>
    <site-doc src="password_generator_explain.md" title="üìò Vysvƒõtlen√≠" toggle></site-doc>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.10.0/styles/github-dark.min.css">
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.10.0/lib/common.min.js"></script>

  <script type="module">
    import { initTheme } from '../js/ui/theme.js';
    import {
      bigPow, formatBigInt, secondsToHuman,
      computeRateAndHashTime, log2, classifyStrength,
      buildAlphabetFromFlags, generatePasswords, computePasswordStats, getExampleTableRows
    } from '../js/tools/cybersec.js';
    initTheme();

    const $ = (s, r=document)=>r.querySelector(s);
    const $$ = (s, r=document)=>[...r.querySelectorAll(s)];

    // UI refs
    const elLen   = $('#len');
    const elCnt   = $('#count');
    const elUpper = $('#useUpper');
    const elLower = $('#useLower');
    const elDigits= $('#useDigits');
    const elSym   = $('#useSymbols');
    const elAmb   = $('#avoidAmb');
    const elEns   = $('#ensureEach');

    const elPwList= $('#pwList');
    const elBadge = $('#strengthBadge');
    const elNote  = $('#strengthNote');

    const elAlpha = $('#alphabetSize');
    const elComb  = $('#combos');
    const elEntr  = $('#entropyBits');
    const elRate  = $('#rate');
    const elTime  = $('#timeCrack');

    const elCopyAll = $('#btnCopyAll');
    const elCopyHint= $('#copyHint');

    // New refs
    const elRateMode = $('#rateMode');
    const elCpuFreq  = $('#cpuFreq');
    const elInstr    = $('#instrPerPw');
    const elHashPreset = $('#hashPreset');
    const elHashMs   = $('#hashMs');
    const elExampleTable = $('#exampleTable');
    const elCpuControls = $('#cpuControls');
    const elHashControls = $('#hashControls');

    // Character sets
    const UPPER = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    const LOWER = 'abcdefghijklmnopqrstuvwxyz';
    const DIGIT = '0123456789';
    const SYMS  = `!@#$%^&*()-_=+[]{};:,.?/\\'"\`~|<>`;

    const AMBIG = new Set(['0','O','o','1','l','I','|','\\',"'",'"','`']);

    // renderPasswords remains UI-specific
    function renderPasswords(list) {
      elPwList.innerHTML = '';
      for (const pw of list) {
        const row = document.createElement('div');
        row.className = 'pw-row';
        row.innerHTML = `
          <div class="mono pw">${pw}</div>
          <button class="btn" data-copy>Copy</button>
        `;
        elPwList.appendChild(row);
      }
      $$('#pwList [data-copy]').forEach((btn, i)=>{
        btn.addEventListener('click', async ()=>{
          const txt = list[i];
          await navigator.clipboard.writeText(txt);
          btn.textContent = 'Copied!';
          setTimeout(()=>btn.textContent='Copy', 900);
        });
      });
    }

    // Wrapper to build flags object from UI controls
    function flagsFromUI() {
      return {
        useUpper: elUpper.checked,
        useLower: elLower.checked,
        useDigits: elDigits.checked,
        useSymbols: elSym.checked,
        avoidAmb: elAmb.checked,
        ensureEach: elEns.checked
      };
    }

    function generateAll() {
      const L = Math.max(4, Math.min(128, parseInt(elLen.value)||16));
      const C = Math.max(1, Math.min(100, parseInt(elCnt.value)||5));
      const flags = flagsFromUI();
      if (buildAlphabetFromFlags(flags).length === 0) {
        renderPasswords(['(Vyber sady znak≈Ø)']);
        recomputeStats();
        return;
      }
      const list = generatePasswords(L, C, flags);
      renderPasswords(list);
      elCopyAll.onclick = async ()=>{
        await navigator.clipboard.writeText(list.join('\n'));
        elCopyHint.textContent = 'Zkop√≠rov√°no do schr√°nky.';
        setTimeout(()=> elCopyHint.textContent='', 1200);
      };
      recomputeStats();
    }

    function recomputeStats() {
      const L = Math.max(4, Math.min(128, parseInt(elLen.value)||16));
      const flags = flagsFromUI();
      const alphabet = buildAlphabetFromFlags(flags);
      const N = Math.max(0, alphabet.length);
      elAlpha.textContent = N.toString();
      if (N === 0) {
        elComb.textContent = '‚Äî';
        elEntr.textContent = '‚Äî';
        elBadge.textContent = '‚Äî';
        elBadge.className = 'tag';
        elNote.textContent = 'Vyber alespo≈à jednu sadu znak≈Ø.';
        elTime.textContent = '‚Äî';
        // example table: still render with empty alphabet
        const rows = getExampleTableRows(flags, [3,8,12,17], {
          mode: elRateMode.value, rate: elRate.value, ghz: elCpuFreq.value, instr: elInstr.value, ms: elHashMs.value
        });
        renderExampleTableRows(rows);
        return;
      }

      const stats = computePasswordStats(L, flags, {
        mode: elRateMode.value, rate: elRate.value, ghz: elCpuFreq.value, instr: elInstr.value, ms: elHashMs.value
      });
      elComb.textContent = stats.combosFmt;
      elEntr.textContent = stats.bits.toFixed(2);
      elBadge.textContent = stats.cls.label;
      elBadge.className = `tag ${stats.cls.cls}`;
      elTime.textContent = stats.timeText;
      elNote.textContent = (stats.bits>=90)
        ? 'Hesla maj√≠ vysokou entropii. P≈ôesto pou≈æ√≠vej spr√°vce hesel a MFA.'
        : (stats.bits>=70)
          ? 'Dobr√° s√≠la. Zva≈æ vƒõt≈°√≠ d√©lku pro citliv√© √∫ƒçty.'
          : 'Zva≈æ prodlou≈æen√≠ d√©lky a/nebo povolen√≠ v√≠ce t≈ô√≠d znak≈Ø.';

      const lengths = [3,8,12,17];
      const curL = Math.max(4, Math.min(128, parseInt(elLen.value)||16));
      if (!lengths.includes(curL)) lengths.push(curL);
      const rows = getExampleTableRows(flags, lengths, {
        mode: elRateMode.value, rate: elRate.value, ghz: elCpuFreq.value, instr: elInstr.value, ms: elHashMs.value
      });
      renderExampleTableRows(rows);
    }

    function renderExampleTableRows(rows) {
      const header = `<thead><tr style="text-align:left;">
        <th style="padding:.25rem .5rem; border-bottom:1px solid var(--border)">D√©lka hesla</th>
        <th style="padding:.25rem .5rem; border-bottom:1px solid var(--border)">mal√° abeceda</th>
        <th style="padding:.25rem .5rem; border-bottom:1px solid var(--border)">velk√° abeceda</th>
        <th style="padding:.25rem .5rem; border-bottom:1px solid var(--border)">ƒç√≠sla</th>
        <th style="padding:.25rem .5rem; border-bottom:1px solid var(--border)">spec. znaky</th>
        <th style="padding:.25rem .5rem; border-bottom:1px solid var(--border)">poƒçet kombinac√≠</th>
        <th style="padding:.25rem .5rem; border-bottom:1px solid var(--border)">d√©lka v√Ωpoƒçtu</th>
      </tr></thead>`;
      const rowsHtml = rows.map(r => `<tr>
        <td style="padding:.25rem .5rem; border-bottom:1px dashed var(--border)">${r.L}</td>
        <td style="padding:.25rem .5rem; border-bottom:1px dashed var(--border)">${r.lower ? '‚úÖ' : '‚ùå'}</td>
        <td style="padding:.25rem .5rem; border-bottom:1px dashed var(--border)">${r.upper ? '‚úÖ' : '‚ùå'}</td>
        <td style="padding:.25rem .5rem; border-bottom:1px dashed var(--border)">${r.digits ? '‚úÖ' : '‚ùå'}</td>
        <td style="padding:.25rem .5rem; border-bottom:1px dashed var(--border)">${r.syms ? '‚úÖ' : '‚ùå'}</td>
        <td style="padding:.25rem .5rem; border-bottom:1px dashed var(--border)">${r.combosFmt}</td>
        <td style="padding:.25rem .5rem; border-bottom:1px dashed var(--border)">${r.secText}</td>
      </tr>`).join('');
      elExampleTable.innerHTML = header + `<tbody>${rowsHtml}</tbody>`;
    }

    // Events
    $$('#len, #count, #useUpper, #useLower, #useDigits, #useSymbols, #avoidAmb, #ensureEach, #rate').forEach(el=>{
      el.addEventListener('input', recomputeStats);
    });
    // new inputs
    $$('#rateMode, #cpuFreq, #instrPerPw, #hashMs, #hashPreset').forEach(el=>el.addEventListener('input', recomputeStats));
    elHashPreset.addEventListener('change', ()=>{ updateRateModeUI(); });

    $('#btnGen').addEventListener('click', generateAll);
    document.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter') generateAll();
    });

    // toggle UI visibility for modes
    function updateRateModeUI() {
      const m = elRateMode.value;
      elCpuControls.style.display = m === 'cpu' ? 'block' : 'none';
      elHashControls.style.display = m === 'hash' ? 'block' : 'none';
    }
    elRateMode.addEventListener('change', ()=>{ updateRateModeUI(); recomputeStats(); });

    // Init UI state
    updateRateModeUI();
    // Init: compute initial stats / preview (but don't force-generate passwords)
    recomputeStats();
  </script>
</body>
</html>
